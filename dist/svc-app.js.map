{"version":3,"file":"svc-app.js","sourceRoot":"","sources":["../src/svc-app.ts"],"names":[],"mappings":";;AAAA,mCAAuD;AACvD,6CAAwD;AACxD,6CAAoC;AAIpC,SAAS;AACT;IASI;QANiB,gBAAW,GAAG,UAAU,CAAC;QAClC,uBAAkB,GAAG,KAAK,CAAC;QAC3B,oBAAe,GAAY,KAAK,CAAC;QAMrC,IAAI,CAAC,UAAU,GAAG,IAAI,kBAAS,EAAE,CAAC;IACtC,CAAC;IAGM,YAAY,CAAC,SAA6B;QAE7C,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,CAAC;YACrB,MAAM,IAAI,uCAAyB,CAAC,cAAc,CAAC,CAAC;QAExD,mBAAK,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC,cAAc,EAAE,CAAC;QAC/C,IAAI,CAAC,UAAU,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;QACnC,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAEM,eAAe,CAAC,YAAsB;QAEzC,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,IAAI,IAAI,CAAC,kBAAkB,CAAC;YAChD,MAAM,IAAI,uCAAyB,CAAC,iBAAiB,CAAC,CAAC;QAE3D,mBAAK,CAAC,YAAY,EAAE,cAAc,CAAC,CAAC,cAAc,EAAE,CAAC,gBAAgB,EAAE,CAAC;QACxE,IAAI,CAAC,UAAU,CAAC,iBAAiB,CAAC,IAAI,CAAC,WAAW,EAAE,YAAY,CAAC,CAAC;QAClE,IAAI,CAAC,kBAAkB,GAAG,IAAI,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC;IAChB,CAAC;IAEM,SAAS;QAEZ,EAAE,CAAC,CAAC,IAAI,CAAC,eAAe,IAAI,CAAC,IAAI,CAAC,kBAAkB,CAAC;YACjD,MAAM,IAAI,uCAAyB,CAAC,WAAW,CAAC,CAAC;QAErD,IAAI,CAAC,UAAU,CAAC,SAAS,EAAE,CAAC;QAE5B,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC;QAE5B,IAAI,OAAO,GAAG,IAAI,CAAC,UAAU,CAAC,OAAO,CAAU,IAAI,CAAC,WAAW,CAAC,CAAC;QACjE,OAAO,CAAC,GAAG,EAAE;aACR,IAAI,CAAC,GAAG,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;aAC5C,KAAK,CAAC,CAAC,GAAG,EAAE,EAAE,CAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,GAAG,CAAC,CAAC,CAAC;IAC5D,CAAC;CACJ;AAlDD,wBAkDC","sourcesContent":["import { Container, ComponentInstaller } from \"n-ject\";\nimport { InvalidOperationException } from \"n-exception\";\nimport { given } from \"n-defensive\";\nimport { Program } from \"./program\";\n\n\n// public\nexport class SvcApp\n{\n    private readonly _container: Container;\n    private readonly _programKey = \"$program\";\n    private _programRegistered = false;\n    private _isBootstrapped: boolean = false;\n    \n    \n    \n    public constructor()\n    {\n        this._container = new Container();\n    }\n    \n    \n    public useInstaller(installer: ComponentInstaller): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useInstaller\");\n\n        given(installer, \"installer\").ensureHasValue();\n        this._container.install(installer);\n        return this;\n    }\n    \n    public registerProgram(programClass: Function): this\n    {\n        if (this._isBootstrapped || this._programRegistered)\n            throw new InvalidOperationException(\"registerProgram\");\n\n        given(programClass, \"programClass\").ensureHasValue().ensureIsFunction();\n        this._container.registerSingleton(this._programKey, programClass);\n        this._programRegistered = true;\n        return this;\n    }\n    \n    public bootstrap(): void\n    {\n        if (this._isBootstrapped || !this._programRegistered)\n            throw new InvalidOperationException(\"bootstrap\");\n\n        this._container.bootstrap();\n        \n        this._isBootstrapped = true;\n        \n        let program = this._container.resolve<Program>(this._programKey);\n        program.run()\n            .then(() => console.log(\"Program complete.\"))\n            .catch((err) => console.log(\"Program error:\", err));\n    }\n}"]}